import { NextResponse } from "next/server"; import type { NextRequest } from "next/server"; import { getToken } from "next-auth/jwt"; export async function middleware(request: NextRequest) { const { pathname } = request.nextUrl; const isProtectedPath = !pathname.startsWith("/auth") && !pathname.startsWith("/api/auth") && !pathname.startsWith("/_next") && pathname !== "/favicon.ico"; if (isProtectedPath) { const token = await getToken({ req: request, secret: process.env.NEXTAUTH_SECRET, }); if (!token) { const url = new URL("/auth/signin", request.url); url.searchParams.set("returnUrl", pathname); return NextResponse.redirect(url); } } return NextResponse.next(); }
